"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[313],{1078(e,n,t){t.d(n,{A:()=>i});const i=t.p+"assets/images/technitium-url-d57cf9ff291ddf40e38d8df02d6030b2.png"},1896(e,n,t){t.d(n,{A:()=>i});const i=t.p+"assets/images/technitium-dns-70707118622d4f5c5ab6af0e35cb5fbc.png"},2922(e,n,t){t.d(n,{A:()=>i});const i="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALsAAAAlCAYAAAAa/JhZAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAADHRFWHRsb2dpY2FsWAA4MTMKBaCrAAAAC3RFWHRsb2dpY2FsWQA1Mp5/tAkAAAAMdEVYdHNjcmVlbgBEUC0xMYzPOoAAAAhNSURBVHhe7ZwLUJTXFcf/+8BdXkZRQVYeAQkiEhTrA18YYwwxWDV21DYktjN5a7QpVjOQqtWgJtZIY2sxTYxtHB8TbNUkYy1JlAKCivGBIgiKvJGnQoQFd4HOPXTX/Xb322V9UGDvb4aZ755zv7vfvZzv3HPOZZGMcJnTAQ7HDpDawRw5HIIbO8dukOtm2oZWaCRNaEMLOqAFj204fQ0y9hZJPTS409fmxuEIkKtRDS1a+LJw+jxSrYQbOsc+4Akqx27gxs6xG7ixc+wGbuwcu0FfZ+f0bpxdnATt/v1dTfrocPcYLKq7c6dJVNfe3i6qc3RUiupuVlbrr+vrbpvt0x1wz86xG2SuCo/fW5vtouh5eHVpNBobf4QEQGPDjxZ6PzgLFs+BTC5DdVWthV69j/+cPYzHBvTH6ZM/WOh1f/Tr5yBoKxQKkz46jHcBQ+7e1YjqOjrEz9UdHMSDBMPdQq3+/5W6rXr2lbFvISFxA8pKKpGQ+D4Zfk8gINAP48PDrMoeFX7DfbD4pResyjg9B6sxe0zsm/jNW2vx5d4j9JN0dBe8fDxN+m3bvBOlJRUm8kfF4/4+aLjdaFX2qHhixHBcL7hhVcbpOVg1dmMD9vZRIamk0qSfl6/qoRq7g1yOyKinMdTTHU1NzcjNyUdOdh7pImZMgq+fN12Hho1CaXE5WtQtJrLkoycoJLp47jKCggMx2N0NzU1qaufnXdd/VlDwEwgMGo6BgwaisaER1/Jv4NKFK6Sbv/B5VFZU4/TJs/r+LBkb5u2JU+nissFD3LA54XeYNiOcnu1k6hm0ttzV92ewsGZHwm78bHEUxk0cg6qb1Tiw5zC2b/1M3+f1t1/GgkVRCAzyR3FROb4+9G9yLH0NhVKBd1a9hpmREfD198KZzPOIfSceZaWVcHJyxLrNv8UzkREUgmWdOo/E7X9HRmqWTctg1diT9n5FYcyiF+eSQbOF/mhzooU7Hg7BoUFkOCnfpZMRT5sxCVWVNaitqUPqiUw4uzjTNZu4DnMyRvjU8TiVnoWyYxUICPSnsVj+cbOimmLo8KnjcOyb46irqYenyh1SmUx/r1wupxfPkIAR/qiprqMxxGRbtq/F6LBReHH+m7hVfxur3luGgMDHBeMw1sTHYEv8n7H89Tj8dP6z2LDlXWSdvoDMtLN4cvRIxK5bgVdfisG5rEuIeDocDg7C2LyvsOXjNZg9dyY+37kf2edz4OHpjoryKprepm1xGPOTEFqjosJS/Oq1xdiTtAOzp/8c+XmFXV4Cq8bODDsjPQuTp45HxgdZ9EvoDspLK/UhAfPCo8eGQOU1lIzZVkqLynC9oIiucy7lwS/Alzw9M3a5XAaJRILW1lZoNBqUFJcL7j24/yuj0Vi44k/jiMkGDR6IZ59/CrExG3EuK5tkcSs3IWreM4J7GJnpZ7FnVxJd79q5D68sjaa1ZuusdFTQi3ervoFemCMHj5ncryMkNEjQHjDwMZM+Ompr6kV1Lq7OojrmCMRQq1tFdYZjMo9tDFsvtoPGr0nApzv2CHSu/V1od172yrt6T75p3ceYNfsp/OKXC7A+dqvRaOJYNXYGW3gxI2cJKwtt2AvxMF+E27caBG3mMRWKfib9uoJxHH+zogqqYUPpuq72Fhnp3AXPofhGGfKu5NNLIAYLT1xdXVBYUCwq8w/wpRcoPeW0vg+bT0VFp6cypPDavXEY5SWVGODWaahZpy5g7+6DSPrmM3yfnEYhzvHkNKMRej/MUTCnc+LbdJPJMJ1MJkX2+VyBPD/3GhUkbMFqNcYSukrNpKnjqFLD2g8LrVZrQWsjElYwvUdbWzsk0nuyMxnncOCLQ6irrcfMyOkU5ogRGBSA4qIy2gXEZLoKnVYjnINxm2GtFMd2hMljopB3pQDb/xqPHZ9/YKF370ZjZn2MS6qGmFtPS3TJszPPba7kyCo14SGzKTFletbujnie0d4hNFgxGcN4S2cniI0Nwi+rsDCGJaVVldWY80IkMlLPoK2tTdBHKpVSCGTogczJWMjEatLBT47QJ+0syfLwHCIYr6uwXIXlSszT7zuUiNXLN1DS3htxdnYyefaCq4V0Ojt6bDCKb5Sa6LTaNoSGjRToAkcG2LzLdcmzs8SUlRsNf5g3NyQzzbbM+EFhoYmXt4qOxfv9L7wxJ2N4+agotGAHLSxpZO3cnKukGzTEDUGjAikRZbDEqKWlVW/oLJacOKVzrr5+XuRNKsruVaPMyVh8nXw0BaveW0pVFrbdbvvLenoxbGHi5LF4Y/kSilsZE8LDKH7XGcv3mQfx4R/XiNzdMzH37CyU/PqfyRQZTJk+gXKzqPmzMMR9EOmO/OMY6SZHjCdd3Ppfw8d3GHZ/sl/kU8zTJc8uFrN3hjHvU5K1MHouVW66i8sX8+Cp8sDC6HkoKSrDt/9KMStjXMnOo3LkjFnT6PQ37USmPi5v02gxZmwIpkRMoHbTnWakfHdS/zmG1RhWRy8qLBE8hzkZY/WKDfjDn9Zh3+FEKJVK/O3TA0g9nmnSzxLq5ha88fYSrN24ktrMw7NxdSgdlVA6if9NSk/G+Nljlq2litWmj+LIObAdcd6sJaRbvWI96TZujYO3rwq5l/Px8sJlVJa0BYnKNfSBvls9ado4Kktmpv9Ah049DZbJX829pq/R91XYLmDI/VZjLOVK91uNUTer9dfmqjHdxQMbe0+HGTsrXV6+KMzmOfaHbUEkh9OL4cbOsRv6fBjD4XDPzrE7eBjDsRu4sXPsBqm8o3ceSnA4tiJ1hDsc0HkczeH0ZegcXNnhBgc4839ZzenT6P82RgYFZB3i30jncHo7PEHl2A3/BWHQYxAvD7iDAAAAAElFTkSuQmCC"},5709(e,n,t){t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>o,default:()=>h,frontMatter:()=>c,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"linux/DNS/technitium-letsencrypt","title":"Technitium Letsencrypt with Cloudflare","description":"This document will walk through the steps to setup Letsencrypt with DoH and Cloudflare. This guide assumes you have a working Technitium install, are running on at least Debian 13 and have a properly configured Cloudflare API token.","source":"@site/docs/linux/DNS/technitium-letsencrypt.md","sourceDirName":"linux/DNS","slug":"/linux/DNS/technitium-letsencrypt","permalink":"/docs/linux/DNS/technitium-letsencrypt","draft":false,"unlisted":false,"editUrl":"https://github.com/echo-core/docs/tree/main/site/docs/linux/DNS/technitium-letsencrypt.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Linux Howtos","permalink":"/docs/category/linux-howtos"},"next":{"title":"Steam Shared Library","permalink":"/docs/linux/Steam/steam-shared-library"}}');var r=t(4848),s=t(8453);const c={},o="Technitium Letsencrypt with Cloudflare",d={},l=[{value:"Install required packages",id:"install-required-packages",level:2},{value:"Configure certbot",id:"configure-certbot",level:2},{value:"Request cert",id:"request-cert",level:2},{value:"Configure Technitium",id:"configure-technitium",level:2},{value:"Test new configuration",id:"test-new-configuration",level:2},{value:"Certbot timer information",id:"certbot-timer-information",level:2},{value:"References",id:"references",level:2}];function a(e){const n={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"technitium-letsencrypt-with-cloudflare",children:"Technitium Letsencrypt with Cloudflare"})}),"\n",(0,r.jsxs)(n.p,{children:["This document will walk through the steps to setup Letsencrypt with DoH and Cloudflare. ",(0,r.jsx)(n.em,{children:"This guide assumes you have a working Technitium install, are running on at least Debian 13 and have a properly configured Cloudflare API token"}),"."]}),"\n",(0,r.jsx)(n.h2,{id:"install-required-packages",children:"Install required packages"}),"\n",(0,r.jsxs)(n.p,{children:["On a ",(0,r.jsx)(n.code,{children:"root"})," shell run the following to install the certbot packages needed to use ",(0,r.jsx)(n.code,{children:"DNS-01"})," challenges."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"apt install certbot python3-certbot-dns-cloudflare -y\n"})}),"\n",(0,r.jsx)(n.h2,{id:"configure-certbot",children:"Configure certbot"}),"\n",(0,r.jsx)(n.p,{children:"Create script to run on a sucessful certificate deploy that will generate an updated pfx cert for Technitium and restart its service."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"mkdir -p /etc/letsencrypt/renewal-hooks/deploy\nvim /etc/letsencrypt/renewal-hooks/deploy/pkcs12convert.sh\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Paste the following into the file. Replace ",(0,r.jsx)(n.code,{children:"domain.com"})," with your domain. You can update the ",(0,r.jsx)(n.code,{children:"passout"})," as well. Save that as you'll need to add that to the Technitium interface to use the newly created cert."]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'#!/usr/bin/env sh\n\n# generate pfx from certs\nopenssl pkcs12 -export -out /etc/letsencrypt/live/domain.com/cert.pfx \\\n        -inkey /etc/letsencrypt/live/domain.com/privkey.pem \\\n        -in /etc/letsencrypt/live/domain.com/cert.pem \\\n        -certfile /etc/letsencrypt/live/domain.com/chain.pem \\\n        -passout pass:changeme\n\n# restart technitium\nsystemctl restart dns\n\necho "pkcs#12 generated!"\n'})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Create a local certbot secret with the Cloudflare API token in it. This should be done as the ",(0,r.jsx)(n.code,{children:"root"})," user for simplicity."]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'mkdir -p ~/.secrets/certbot\necho "dns_cloudflare_api_token = YOUR_API_TOKEN" > ~/.secrets/certbot/cloudflare.ini\nchmod 600 ~/.secrets/certbot/cloudflare.ini\n'})}),"\n",(0,r.jsx)(n.h2,{id:"request-cert",children:"Request cert"}),"\n",(0,r.jsxs)(n.p,{children:["Request cert manually for initial deployment. Replace ",(0,r.jsx)(n.code,{children:"domain.com"})," with your domain and ",(0,r.jsx)(n.code,{children:"user@domain.com"})," with the appropriate email address."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"certbot certonly --dns-cloudflare \\\n  --dns-cloudflare-credentials ~/.secrets/certbot/cloudflare.ini \\\n  -d domain.com \\\n  -d *.domain.com \\\n  --agree-tos \\\n  --email user@domain.com \\\n  --non-interactive\n"})}),"\n",(0,r.jsx)(n.h2,{id:"configure-technitium",children:"Configure Technitium"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Configure Cert in Technitium."}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Launch the Technitium management interface then go to ",(0,r.jsx)(n.code,{children:"Settings -> Optional Protocols"}),", then scroll to the bottom of the page and modify ",(0,r.jsx)(n.code,{children:"TLS Certificate File Path"})," to the following. Modify ",(0,r.jsx)(n.code,{children:"domain.com"})," to your domain and enter the password that you used in the script in step 2 in the ",(0,r.jsx)(n.code,{children:"TLS Certificate Password"})," field. Once you have done that, go ahead and click ",(0,r.jsx)(n.code,{children:"Save Settings"})," at the bottom of the page."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"Technitium Cert",src:t(7347).A+"",width:"1120",height:"287"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Configure DoH, DoT, and DoQ."}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"On the same page from step 5, enable the following services to make use of the new cert."}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"DNS-over-HTTP"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"DNS-over-TLS"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"DNS-over-HTTPS"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"DNS-over-HTTPS/3"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"DNS-over-QUIC"})}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"Technitium Cert",src:t(1896).A+"",width:"1125",height:"629"})}),"\n",(0,r.jsx)(n.h2,{id:"test-new-configuration",children:"Test new configuration"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Test interface to ensure it's functioning correctly now."}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Browse to the url of your Technitium DNS server. You should have something like dns.domain.com setup. Your browser should not show any issues with the site when visiting the URL."}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"Technitium Cert",src:t(2922).A+"",width:"187",height:"37"})}),"\n",(0,r.jsx)(n.p,{children:"and your informational page should now load showing your users how to congfigure their browser to point to the new secure DNS endpoint."}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"Technitium Cert",src:t(1078).A+"",width:"955",height:"846"})}),"\n",(0,r.jsxs)(n.ol,{start:"2",children:["\n",(0,r.jsx)(n.li,{children:"Test dns resolution on new protocols."}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Use ",(0,r.jsx)(n.code,{children:"dig"})," to test ",(0,r.jsx)(n.code,{children:"DoT"}),"."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"dig @dns.domain.com +tls domain.com|tail -5\n"})}),"\n",(0,r.jsx)(n.p,{children:"In the output the following and we can see a successful query."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:";; Query time: 2 msec\n;; SERVER: 192.168.0.8#853(dns.domain.com) (TLS)\n;; WHEN: Tue Dec 23 18:02:29 EST 2025\n;; MSG SIZE  rcvd: 54\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Use ",(0,r.jsx)(n.code,{children:"dig"})," to test ",(0,r.jsx)(n.code,{children:"DoH"}),"."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"dig @dns.domain.com +https domain.com|tail -5\n"})}),"\n",(0,r.jsx)(n.p,{children:"In the output the following and we can see a successful query."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:";; Query time: 3 msec\n;; SERVER: 192.168.0.8#443(dns.domain.com) (HTTPS)\n;; WHEN: Tue Dec 23 18:04:20 EST 2025\n;; MSG SIZE  rcvd: 54\n"})}),"\n",(0,r.jsx)(n.h2,{id:"certbot-timer-information",children:"Certbot timer information"}),"\n",(0,r.jsxs)(n.p,{children:["Certbot, when installed on Debian 13, will install a systemd timer that runs ",(0,r.jsx)(n.code,{children:"certbot renew"})," twice a day. See snippet below."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"root@dns:~# systemctl cat certbot.timer\n# /usr/lib/systemd/system/certbot.timer\n[Unit]\nDescription=Run certbot twice daily\n\n[Timer]\nOnCalendar=*-*-* 00,12:00:00\nRandomizedDelaySec=43200\nPersistent=true\n\n[Install]\nWantedBy=timers.target\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Which you can see calls the ",(0,r.jsx)(n.code,{children:"certbot.service"})," below which runs the ",(0,r.jsx)(n.code,{children:"ExecStart"})," for the ",(0,r.jsx)(n.code,{children:"certbot renew"})," command."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"root@dns:~# systemctl cat certbot.service\n# /usr/lib/systemd/system/certbot.service\n[Unit]\nDescription=Certbot\nDocumentation=file:///usr/share/doc/python-certbot-doc/html/index.html\nDocumentation=https://certbot.eff.org/docs\n[Service]\nType=oneshot\nExecStart=/usr/bin/certbot -q renew --no-random-sleep-on-renew\nPrivateTmp=true\n"})}),"\n",(0,r.jsx)(n.h2,{id:"references",children:"References"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://blog.technitium.com/2020/07/how-to-host-your-own-dns-over-https-and.html",children:"Hosting DoH, DoT, and DoQ services"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://ambientnode.uk/setting-up-dns-over-https-on-technitium-with-cloudflare",children:"Setting up DoH on Technitium with Cloudflare"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}},7347(e,n,t){t.d(n,{A:()=>i});const i=t.p+"assets/images/technitium-cert-2467b335de4fba3462407b11127edfeb.png"},8453(e,n,t){t.d(n,{R:()=>c,x:()=>o});var i=t(6540);const r={},s=i.createContext(r);function c(e){const n=i.useContext(s);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:c(e.components),i.createElement(s.Provider,{value:n},e.children)}}}]);