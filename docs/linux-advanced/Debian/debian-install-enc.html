<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-linux-advanced/Debian/debian-install-enc" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">Debian Full Disk Encryption Installation | Echols Home</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://echols.co/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://echols.co/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://echols.co/docs/linux-advanced/Debian/debian-install-enc"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Debian Full Disk Encryption Installation | Echols Home"><meta data-rh="true" name="description" content="This was done with a lot of research, trial-and-error, and finally led to success. Eventually, I would like to do a full debootstrap installation to avoid some of the annoyances in this article. I would do another article for that setup."><meta data-rh="true" property="og:description" content="This was done with a lot of research, trial-and-error, and finally led to success. Eventually, I would like to do a full debootstrap installation to avoid some of the annoyances in this article. I would do another article for that setup."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://echols.co/docs/linux-advanced/Debian/debian-install-enc"><link data-rh="true" rel="alternate" href="https://echols.co/docs/linux-advanced/Debian/debian-install-enc" hreflang="en"><link data-rh="true" rel="alternate" href="https://echols.co/docs/linux-advanced/Debian/debian-install-enc" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Linux Howtos - Advanced","item":"https://echols.co/docs/category/linux-howtos---advanced"},{"@type":"ListItem","position":2,"name":"Debian Full Disk Encryption Installation","item":"https://echols.co/docs/linux-advanced/Debian/debian-install-enc"}]}</script><link rel="stylesheet" href="/assets/css/styles.fab7e20c.css">
<script src="/assets/js/runtime~main.b8fc83cf.js" defer="defer"></script>
<script src="/assets/js/main.434fab60.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||"dark"),document.documentElement.setAttribute("data-theme-choice",t||"dark")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/img/echols-home-logo.svg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_wko1" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/echols-home-logo.svg" alt="Echols Home" class="themedComponent_W04U themedComponent--light_x77O"><img src="/img/echols-home-logo.svg" alt="Echols Home" class="themedComponent_W04U themedComponent--dark_R_hE"></div><b class="navbar__title text--truncate">Echols Home</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/welcome">Articles</a><a class="navbar__item navbar__link" href="/heaven">Heaven</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/echo-core/docs-site" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_yTpy"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_CfZ2 colorModeToggle_icDH"><button class="clean-btn toggleButton_pxMD toggleButtonDisabled_VJhY" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_FBVn lightToggleIcon_vn1B"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_FBVn darkToggleIcon_mVBn"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_FBVn systemToggleIcon_WfAn"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_FX5g"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_WYpE"><div class="docsWrapper_S0FO"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_rkI3" type="button"></button><div class="docRoot_Ik3k"><aside class="theme-doc-sidebar-container docSidebarContainer_B8H8"><div class="sidebarViewport_j_jA"><div class="sidebar_A0KT"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_A7Pa"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/welcome"><span title="Welcome" class="linkLabel_DUIi">Welcome</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_sxd9 menu__link menu__link--sublist" href="/docs/category/linux-howtos"><span title="Linux Howtos" class="categoryLinkLabel_RYpO">Linux Howtos</span></a><button aria-label="Expand sidebar category &#x27;Linux Howtos&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_sxd9 menu__link menu__link--sublist menu__link--active" href="/docs/category/linux-howtos---advanced"><span title="Linux Howtos - Advanced" class="categoryLinkLabel_RYpO">Linux Howtos - Advanced</span></a><button aria-label="Collapse sidebar category &#x27;Linux Howtos - Advanced&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_sxd9 menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/docs/linux-advanced/Debian/debian-install-enc"><span title="Debian" class="categoryLinkLabel_RYpO">Debian</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/linux-advanced/Debian/debian-install-enc"><span title="Debian Full Disk Encryption Installation" class="linkLabel_DUIi">Debian Full Disk Encryption Installation</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_sxd9 menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/linux-advanced/Docker/postgres-upgrades"><span title="Docker" class="categoryLinkLabel_RYpO">Docker</span></a></div></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_qahr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_XUiV"><div class="docItemContainer_Q97s"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_g5mB" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_tM2n"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/docs/category/linux-howtos---advanced"><span>Linux Howtos - Advanced</span></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Debian</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Debian Full Disk Encryption Installation</span></li></ul></nav><div class="tocCollapsible_hwWy theme-doc-toc-mobile tocMobile_Eplo"><button type="button" class="clean-btn tocCollapsibleButton_OdP5">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Debian Full Disk Encryption Installation</h1></header>
<p>This was done with a lot of research, trial-and-error, and finally led to success. Eventually, I would like to do a full <code>debootstrap</code> installation to avoid some of the annoyances in this article. I would do another article for that setup.</p>
<p>I personally use Debin Sid for this, since the purpose was to roll newer versions of software with the understanding that Sid can break. This provides protection against that breakage and allows for easy rollback if and when that situation arises.</p>
<p>At the time of this writing, Debian Trixie is using GRUB 2.12, which is compatible with luks2, but it only supports the <code>pbkdf2</code> algorithm. This installation will do the following:</p>
<ul>
<li class="">Install Debian using the Expert Install option.</li>
<li class="">Create an EFI partition.</li>
<li class="">Create a luks2 container.</li>
<li class="">Create BTRFS root parititon.</li>
<li class="">Downgrade pbkdf to <code>pbkdf2</code>.</li>
<li class="">Install Debian base system.</li>
<li class="">Install GRUB Boot Loader.</li>
<li class="">Install Snapper and associated tools to make managing snapshots easy.</li>
<li class="">Create a base installation snapshot that can be reverted to at anytime.</li>
</ul>
<p>In addition, the BTRFS subvolumes created ensure that rolling back actually works while balancing ignoring cruft from system snapshots and will not touch a user&#x27;s <code>/home</code> folder. This makes it safe to rollback only the system and not worry about data loss in a user&#x27;s home folder.</p>
<div class="theme-admonition theme-admonition-warning admonition_xX1y alert alert--warning"><div class="admonitionHeading_A3Fz"><span class="admonitionIcon__yUe"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_Q3kV"><p>Make sure to keep backups anyway, because you never know...</p></div></div>
<h2 class="anchor anchorTargetStickyNavbar_LfiV" id="install-debian">Install Debian<a href="#install-debian" class="hash-link" aria-label="Direct link to Install Debian" title="Direct link to Install Debian" translate="no">​</a></h2>
<div class="theme-admonition theme-admonition-tip admonition_xX1y alert alert--success"><div class="admonitionHeading_A3Fz"><span class="admonitionIcon__yUe"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_Q3kV"><p>You can grab the latest stable Debian <code>netinst</code> iso from <strong><em><a href="https://www.debian.org/distrib/netinst" target="_blank" rel="noopener noreferrer" class="">here</a></em></strong>.</p><p>You can grab the latest unstable Debian <code>mini</code> iso from <strong><em><a href="https://d-i.debian.org/daily-images/" target="_blank" rel="noopener noreferrer" class="">here</a></em></strong>.</p></div></div>
<ol>
<li class="">
<p>Boot iso and select the <code>Advanced Options... &gt; Expert install</code> option.</p>
</li>
<li class="">
<p>Run through the install then run the <code>Partition disks</code> part of the install in this order.</p>
<ul>
<li class="">Use gpt partition type</li>
<li class="">Create Partitions<!-- -->
<ul>
<li class="">EFI - 512MB</li>
<li class="">Create Encrypted Container<!-- -->
<ul>
<li class="">Set your password to unlock your luks2 volume. Don&#x27;t lose this, you&#x27;ll need it to unlock your computer at every boot moving forward.</li>
</ul>
</li>
<li class="">Create a root BTRFS partition.</li>
</ul>
</li>
</ul>
</li>
<li class="">
<p>Go to the console: <code>ctrl+alt+f3</code>.</p>
</li>
<li class="">
<p>Unmount Debian&#x27;s current BTRFS <code>@rootfs</code> volume from <code>/target</code>.</p>
</li>
</ol>
<div class="language-bash codeBlockContainer_y9gH theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_xTJK"><pre tabindex="0" class="prism-code language-bash codeBlock_Nq72 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines__9ny"><span class="token-line" style="color:#F8F8F2"><span class="token plain">umount /target/boot/efi</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">umount /target</span><br></span></code></pre></div></div>
<ol start="5">
<li class="">Downgrade pbkdf of luks2 container from <code>argon2id</code> to <code>pbkdf2</code>.</li>
</ol>
<div class="language-bash codeBlockContainer_y9gH theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_xTJK"><pre tabindex="0" class="prism-code language-bash codeBlock_Nq72 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines__9ny"><span class="token-line" style="color:#F8F8F2"><span class="token plain">cryptsetup luksConvertKey --pbkdf pbkdf2 /dev/vda2</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-tip admonition_xX1y alert alert--success"><div class="admonitionHeading_A3Fz"><span class="admonitionIcon__yUe"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_Q3kV"><p>This can be upgraded later when GRUB supports <code>argon2id</code> and will <strong><em>NOT</em></strong> require wiping your drive to do this. This will make the installation process much easier when that is implemented as we will only need to focus on the BTRFS subvolumes and not worry about this steps for the GRUB Boot Loader.</p></div></div>
<ol start="6">
<li class="">Mount BTRFS parittion.</li>
</ol>
<div class="language-bash codeBlockContainer_y9gH theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_xTJK"><pre tabindex="0" class="prism-code language-bash codeBlock_Nq72 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines__9ny"><span class="token-line" style="color:#F8F8F2"><span class="token plain">mount /dev/mapper/vda2_crypt /mnt</span><br></span></code></pre></div></div>
<ol start="7">
<li class="">Configure BTRFS subvolumes.</li>
</ol>
<div class="language-bash codeBlockContainer_y9gH theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_xTJK"><pre tabindex="0" class="prism-code language-bash codeBlock_Nq72 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines__9ny"><span class="token-line" style="color:#F8F8F2"><span class="token plain">cd /mnt</span><br></span></code></pre></div></div>
<p>Create optimized subvolumes.</p>
<div class="language-bash codeBlockContainer_y9gH theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_xTJK"><pre tabindex="0" class="prism-code language-bash codeBlock_Nq72 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines__9ny"><span class="token-line" style="color:#F8F8F2"><span class="token plain">btrfs sub cr @</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">btrfs sub cr @grub</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">btrfs sub cr @home</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">btrfs sub cr @root</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">btrfs sub cr @snapshots</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">btrfs sub cr @srv</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">btrfs sub cr @var_cache</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">btrfs sub cr @var_containers</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">btrfs sub cr @var_libvirt</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">btrfs sub cr @var_log</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">btrfs sub cr @var_tmp</span><br></span></code></pre></div></div>
<ol start="8">
<li class="">Mount root BTRFS subvolume.</li>
</ol>
<div class="language-bash codeBlockContainer_y9gH theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_xTJK"><pre tabindex="0" class="prism-code language-bash codeBlock_Nq72 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines__9ny"><span class="token-line" style="color:#F8F8F2"><span class="token plain">mount -o subvol=@ /dev/mapper/vda2_crypt /target</span><br></span></code></pre></div></div>
<ol start="9">
<li class="">Create needed directories, modify as needed.</li>
</ol>
<div class="language-bash codeBlockContainer_y9gH theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_xTJK"><pre tabindex="0" class="prism-code language-bash codeBlock_Nq72 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines__9ny"><span class="token-line" style="color:#F8F8F2"><span class="token plain">mkdir -p /target/boot/efi</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">mkdir -p /target/boot/grub/x86_64-efi</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">mkdir /target/etc</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">mkdir /target/.snapshots</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">mkdir /target/home</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">mkdir /target/root</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">mkdir /target/srv</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">mkdir -p /target/var/cache</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">mkdir -p /target/var/lib/containers</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">mkdir -p /target/var/lib/libvirt/images</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">mkdir -p /target/var/log</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">mkdir -p /target/var/tmp</span><br></span></code></pre></div></div>
<p>Disable CoW (Copy on Write) for libvirt:</p>
<div class="language-bash codeBlockContainer_y9gH theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_xTJK"><pre tabindex="0" class="prism-code language-bash codeBlock_Nq72 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines__9ny"><span class="token-line" style="color:#F8F8F2"><span class="token plain">chattr +C /target/var/lib/libvirt/images</span><br></span></code></pre></div></div>
<ol start="10">
<li class="">Mount BTRFS subvolumes and efi partition to <code>/target</code> directories.</li>
</ol>
<div class="language-bash codeBlockContainer_y9gH theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_xTJK"><pre tabindex="0" class="prism-code language-bash codeBlock_Nq72 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines__9ny"><span class="token-line" style="color:#F8F8F2"><span class="token plain">mount -o subvol=@grub /dev/mapper/vda2_crypt /target/boot/grub/x86_64-efi</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">mount -o subvol=@home /dev/mapper/vda2_crypt /target/home</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">mount -o subvol=@snapshots /dev/mapper/vda2_crypt /target/.snapshots</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">mount -o subvol=@root /dev/mapper/vda2_crypt /target/root</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">mount -o subvol=@srv /dev/mapper/vda2_crypt /target/srv</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">mount -o subvol=@var_cache /dev/mapper/vda2_crypt /target/var/cache</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">mount -o subvol=@var_containers /dev/mapper/vda2_crypt /target/var/lib/containers</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">mount -o subvol=@var_libvirt /dev/mapper/vda2_crypt /target/var/lib/libvirt/images</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">mount -o subvol=@var_log /dev/mapper/vda2_crypt /target/var/log</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">mount -o subvol=@var_tmp /dev/mapper/vda2_crypt /target/var/tmp</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">mount /dev/vda1 /target/boot/efi</span><br></span></code></pre></div></div>
<ol start="11">
<li class="">Copy fstab and crypttab from @rootfs to <code>@</code>.</li>
</ol>
<div class="language-bash codeBlockContainer_y9gH theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_xTJK"><pre tabindex="0" class="prism-code language-bash codeBlock_Nq72 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines__9ny"><span class="token-line" style="color:#F8F8F2"><span class="token plain">cp /mnt/@rootfs/etc/* /target/etc/</span><br></span></code></pre></div></div>
<ol start="12">
<li class="">Edit fstab with new BTRFS subvolumes.</li>
</ol>
<div class="language-bash codeBlockContainer_y9gH theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_xTJK"><pre tabindex="0" class="prism-code language-bash codeBlock_Nq72 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines__9ny"><span class="token-line" style="color:#F8F8F2"><span class="token plain">nano /target/etc/fstab</span><br></span></code></pre></div></div>
<div class="language-bash codeBlockContainer_y9gH theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_xTJK"><pre tabindex="0" class="prism-code language-bash codeBlock_Nq72 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines__9ny"><span class="token-line" style="color:#F8F8F2"><span class="token plain">/dev/mapper/vda2_crypt /               btrfs   defaults,noatime,compress=zstd,subvol=@ 0       0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/dev/mapper/vda2_crypt /.snapshots               btrfs   defaults,noatime,compress=zstd,commit=120,subvol=@snapshots 0       0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/dev/mapper/vda2_crypt /boot/grub/x86_64-efi               btrfs   defaults,noatime,compress=zstd,commit=120,subvol=@grub 0       0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/dev/mapper/vda2_crypt /home               btrfs   defaults,noatime,compress=zstd,commit=120,subvol=@home 0       0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/dev/mapper/vda2_crypt /root               btrfs   defaults,noatime,compress=zstd,commit=120,subvol=@root 0       0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/dev/mapper/vda2_crypt /srv               btrfs   defaults,noatime,compress=zstd,commit=120,subvol=@srv 0       0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/dev/mapper/vda2_crypt /var/cache               btrfs   defaults,noatime,compress=zstd,commit=120,subvol=@var_cache 0       0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/dev/mapper/vda2_crypt /var/lib/containers               btrfs   defaults,noatime,compress=zstd,commit=120,subvol=@var_containers 0       0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/dev/mapper/vda2_crypt /var/lib/libvirt/images               btrfs   defaults,noatime,nodatacow,commit=120,subvol=@var_libvirt 0       0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/dev/mapper/vda2_crypt /var/logs               btrfs   defaults,noatime,compress=zstd,commit=120,subvol=@var_logs 0       0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/dev/mapper/vda2_crypt /var/tmp               btrfs   defaults,noatime,compress=zstd,commit=120,subvol=@var_tmp 0       0</span><br></span></code></pre></div></div>
<ol start="13">
<li class="">Remove old BTRFS <code>@rootfs</code> (Debian default root volume) subvolume.</li>
</ol>
<div class="language-bash codeBlockContainer_y9gH theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_xTJK"><pre tabindex="0" class="prism-code language-bash codeBlock_Nq72 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines__9ny"><span class="token-line" style="color:#F8F8F2"><span class="token plain">btrfs sub del /mnt/@rootfs</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">umount /mnt</span><br></span></code></pre></div></div>
<ol start="14">
<li class="">
<p>Continue installation: <code>ctrl+alt+f1</code>.</p>
<ul>
<li class="">Install base system</li>
<li class="">Configure package manager</li>
<li class="">Select and install software - standard system utilities only</li>
</ul>
</li>
<li class="">
<p>Install the GRUB boot loader: when grub-install fails go back to the console with <code>ctrl+alt+f3</code>.</p>
</li>
<li class="">
<p>Edit the default grub config to allow for crypt volumes.</p>
</li>
</ol>
<div class="language-bash codeBlockContainer_y9gH theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_xTJK"><pre tabindex="0" class="prism-code language-bash codeBlock_Nq72 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines__9ny"><span class="token-line" style="color:#F8F8F2"><span class="token plain">echo &quot;GRUB_ENABLE_CRYPTODISK=y&quot; &gt;&gt;/target/etc/default/grub</span><br></span></code></pre></div></div>
<ol start="17">
<li class="">
<p>Go back the install console: <code>ctrl+alt+f1</code>.</p>
</li>
<li class="">
<p>Run <code>Install the GRUB boot loader</code> again, it should finish successfully this time.</p>
</li>
<li class="">
<p>Finish the installation and then reboot.</p>
</li>
</ol>
<h2 class="anchor anchorTargetStickyNavbar_LfiV" id="create-key-to-keep-from-being-asked-for-two-passwords">Create key to keep from being asked for two passwords<a href="#create-key-to-keep-from-being-asked-for-two-passwords" class="hash-link" aria-label="Direct link to Create key to keep from being asked for two passwords" title="Direct link to Create key to keep from being asked for two passwords" translate="no">​</a></h2>
<ol>
<li class="">Generate the root partition encryption key.</li>
</ol>
<div class="language-bash codeBlockContainer_y9gH theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_xTJK"><pre tabindex="0" class="prism-code language-bash codeBlock_Nq72 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines__9ny"><span class="token-line" style="color:#F8F8F2"><span class="token plain">mkdir -m0700 /etc/keys</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">( umask 0077 &amp;&amp; dd if=/dev/urandom bs=1 count=64 of=/etc/keys/root.key conv=excl,fsync )</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">cryptsetup luksAddKey /dev/vda2 /etc/keys/root.key</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">cryptsetup luksDump /dev/vda2 | grep &quot;^Keyslots&quot; -A16</span><br></span></code></pre></div></div>
<p>Output:</p>
<div class="language-bash codeBlockContainer_y9gH theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_xTJK"><pre tabindex="0" class="prism-code language-bash codeBlock_Nq72 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines__9ny"><span class="token-line" style="color:#F8F8F2"><span class="token plain">Keyslots:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  0: luks2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Keyslots:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  1: luks2</span><br></span></code></pre></div></div>
<ol start="2">
<li class="">Modify <code>crypttab</code> with new key for the root device entry.</li>
</ol>
<div class="language-bash codeBlockContainer_y9gH theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_xTJK"><pre tabindex="0" class="prism-code language-bash codeBlock_Nq72 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines__9ny"><span class="token-line" style="color:#F8F8F2"><span class="token plain">cat /etc/crypttab</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">vda2_crypt UUID=… /etc/keys/root.key luks,discard,x-initrd.attach,key-slot=1</span><br></span></code></pre></div></div>
<ol start="3">
<li class="">Add a glob to look for keys automatically in the <code>cryptsetup-initramfs</code> hook.</li>
</ol>
<div class="language-bash codeBlockContainer_y9gH theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_xTJK"><pre tabindex="0" class="prism-code language-bash codeBlock_Nq72 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines__9ny"><span class="token-line" style="color:#F8F8F2"><span class="token plain">echo &quot;KEYFILE_PATTERN=\&quot;/etc/keys/*.key\&quot;&quot; &gt;&gt;/etc/cryptsetup-initramfs/conf-hook</span><br></span></code></pre></div></div>
<ol start="4">
<li class="">Set the <code>UMASK</code> to prevent key leakage.</li>
</ol>
<div class="language-bash codeBlockContainer_y9gH theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_xTJK"><pre tabindex="0" class="prism-code language-bash codeBlock_Nq72 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines__9ny"><span class="token-line" style="color:#F8F8F2"><span class="token plain">echo UMASK=0077 &gt;&gt;/etc/initramfs-tools/initramfs.conf</span><br></span></code></pre></div></div>
<ol start="5">
<li class="">Regenerate the initramfs image.</li>
</ol>
<div class="language-bash codeBlockContainer_y9gH theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_xTJK"><pre tabindex="0" class="prism-code language-bash codeBlock_Nq72 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines__9ny"><span class="token-line" style="color:#F8F8F2"><span class="token plain">update-initramfs -u -k all</span><br></span></code></pre></div></div>
<ol start="6">
<li class="">Make sure the permissions are restrictive on the initramfs.</li>
</ol>
<div class="language-bash codeBlockContainer_y9gH theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_xTJK"><pre tabindex="0" class="prism-code language-bash codeBlock_Nq72 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines__9ny"><span class="token-line" style="color:#F8F8F2"><span class="token plain">stat -L -c &quot;%A  %n&quot; /initrd.img</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-rw-------  /initrd.img</span><br></span></code></pre></div></div>
<ol start="7">
<li class="">Verify the key file has been imported into the initrd image.</li>
</ol>
<div class="language-bash codeBlockContainer_y9gH theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_xTJK"><pre tabindex="0" class="prism-code language-bash codeBlock_Nq72 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines__9ny"><span class="token-line" style="color:#F8F8F2"><span class="token plain">lsinitramfs /initrd.img | grep &quot;^cryptroot/keyfiles/&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">cryptroot/keyfiles/vda2_crypt.key</span><br></span></code></pre></div></div>
<ol start="8">
<li class="">Reboot and you should only be presented with the initial password on boot then you will hit the grub boot menu.</li>
</ol>
<div class="language-bash codeBlockContainer_y9gH theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_xTJK"><pre tabindex="0" class="prism-code language-bash codeBlock_Nq72 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines__9ny"><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo reboot</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_LfiV" id="configure-snapper-and-grub-btrfs">Configure snapper and grub-btrfs<a href="#configure-snapper-and-grub-btrfs" class="hash-link" aria-label="Direct link to Configure snapper and grub-btrfs" title="Direct link to Configure snapper and grub-btrfs" translate="no">​</a></h2>
<ol>
<li class="">Install snapper.</li>
</ol>
<div class="language-bash codeBlockContainer_y9gH theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_xTJK"><pre tabindex="0" class="prism-code language-bash codeBlock_Nq72 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines__9ny"><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo apt install snapper inotify-tools build-essential git wget curl</span><br></span></code></pre></div></div>
<ol start="2">
<li class="">On installation, <code>snapper</code> created a new BTRFS subvolume (<code>/.snapshots</code>) during the install, but we want to use ours since we&#x27;re using a flat BTRSFS subvolume layout. So let&#x27;s remove the one it created and use ours again.</li>
</ol>
<div class="language-bash codeBlockContainer_y9gH theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_xTJK"><pre tabindex="0" class="prism-code language-bash codeBlock_Nq72 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines__9ny"><span class="token-line" style="color:#F8F8F2"><span class="token plain">cd /</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo umount .snapshots</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo rm -r .snapshots</span><br></span></code></pre></div></div>
<ol start="3">
<li class="">Create a new snapper config for the <code>@</code> subvolume.</li>
</ol>
<div class="language-bash codeBlockContainer_y9gH theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_xTJK"><pre tabindex="0" class="prism-code language-bash codeBlock_Nq72 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines__9ny"><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo snapper -c root create-config /</span><br></span></code></pre></div></div>
<ol start="4">
<li class="">Delete the snapper created subvolume.</li>
</ol>
<div class="language-bash codeBlockContainer_y9gH theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_xTJK"><pre tabindex="0" class="prism-code language-bash codeBlock_Nq72 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines__9ny"><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo btrfs subvolume delete /.snapshots</span><br></span></code></pre></div></div>
<ol start="5">
<li class="">Use our <code>@snapshots</code> subvolume.</li>
</ol>
<div class="language-bash codeBlockContainer_y9gH theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_xTJK"><pre tabindex="0" class="prism-code language-bash codeBlock_Nq72 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines__9ny"><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo mkdir /.snapshots</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo mount -av</span><br></span></code></pre></div></div>
<ol start="6">
<li class="">Disable the snapper boot time snapshots (unless you want them).</li>
</ol>
<div class="language-bash codeBlockContainer_y9gH theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_xTJK"><pre tabindex="0" class="prism-code language-bash codeBlock_Nq72 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines__9ny"><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo systemctl disable snapper-boot.timer</span><br></span></code></pre></div></div>
<ol start="7">
<li class="">Set the following snapper configs.</li>
</ol>
<div class="language-bash codeBlockContainer_y9gH theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_xTJK"><pre tabindex="0" class="prism-code language-bash codeBlock_Nq72 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines__9ny"><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo nano /etc/snapper/configs/root</span><br></span></code></pre></div></div>
<p>Recommended configuration for <code>root</code>, but can be tweaked to your liking.</p>
<div class="language-text codeBlockContainer_y9gH theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_xTJK"><pre tabindex="0" class="prism-code language-text codeBlock_Nq72 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines__9ny"><span class="token-line" style="color:#F8F8F2"><span class="token plain">SUBVOLUME=&quot;/&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">FSTYPE=&quot;btrfs&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ALLOW_GROUPS=&quot;sudo&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">SYNC_ACL=&quot;yes&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">BACKGROUND_COMPARISON=&quot;yes&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">NUMBER_CLEANUP=yes&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">NUMBER_MIN_AGE&quot;1800&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">NUMBER_LIMIT=&quot;20&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">NUMBER_LIMIT_IMPORTANT=&quot;10&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">TIMELINE_CREATE=&quot;no&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">TIMELINE_CLEANUP=&quot;yes&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">TIMELINE_MIN_AGE=&quot;1800&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">TIMELINE_LIMIT_HOURLY=&quot;5&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">TIMELINE_LIMIT_DAILY=&quot;7&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">TIMELINE_LIMIT_WEEKLY=&quot;0&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">TIMELINE_LIMIT_YEARLY=&quot;0&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">EMPTY_PRE_POST_CLEANUP=&quot;yes&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">EMPTY_PRE_POST_MIN_AGE=&quot;1800&quot;</span><br></span></code></pre></div></div>
<ol start="8">
<li class="">Install grub-btrfs.</li>
</ol>
<div class="language-bash codeBlockContainer_y9gH theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_xTJK"><pre tabindex="0" class="prism-code language-bash codeBlock_Nq72 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines__9ny"><span class="token-line" style="color:#F8F8F2"><span class="token plain">cd ~</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">mkdir git</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">cd git</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">git clone https://github.com/Antynea/grub-btrfs.git</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">cd grub-btrfs</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo make install</span><br></span></code></pre></div></div>
<ol start="9">
<li class="">Enable and start service.</li>
</ol>
<div class="language-bash codeBlockContainer_y9gH theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_xTJK"><pre tabindex="0" class="prism-code language-bash codeBlock_Nq72 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines__9ny"><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo systemctl enable grub-btrfsd</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo systemctl start grub-btrfsd</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_LfiV" id="more-useful-snapshot-descriptions">More useful snapshot descriptions<a href="#more-useful-snapshot-descriptions" class="hash-link" aria-label="Direct link to More useful snapshot descriptions" title="Direct link to More useful snapshot descriptions" translate="no">​</a></h2>
<ol>
<li class="">Backup existing snapper apt config.</li>
</ol>
<div class="language-bash codeBlockContainer_y9gH theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_xTJK"><pre tabindex="0" class="prism-code language-bash codeBlock_Nq72 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines__9ny"><span class="token-line" style="color:#F8F8F2"><span class="token plain">cp /etc/apt/apt.conf.d/80snapper /etc/apt/apt.conf.d/80snapper~</span><br></span></code></pre></div></div>
<ol start="2">
<li class="">Clone scripts.</li>
</ol>
<div class="language-bash codeBlockContainer_y9gH theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_xTJK"><pre tabindex="0" class="prism-code language-bash codeBlock_Nq72 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines__9ny"><span class="token-line" style="color:#F8F8F2"><span class="token plain">cd ~/git</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">git clone https://gist.github.com/f722f6d08dfb404fed2a3b2d83263118.git dpkg-pre-post-snapper</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">cd dpkg-pre-post-snapper</span><br></span></code></pre></div></div>
<ol start="3">
<li class="">Install scripts.</li>
</ol>
<div class="language-bash codeBlockContainer_y9gH theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_xTJK"><pre tabindex="0" class="prism-code language-bash codeBlock_Nq72 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines__9ny"><span class="token-line" style="color:#F8F8F2"><span class="token plain">chmod +x dpkg-pre-post-snapper.sh</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo cp dpkg-pre-post-snapper.sh /usr/local/sbin/dpkg-pre-post-snapper</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo cp 80snapper /etc/apt/apt.conf.d/</span><br></span></code></pre></div></div>
<ol start="4">
<li class="">Edit dpkg-pre-post-snapper location and modify the <code>/path/to/</code> to <code>/usr/local/sbin/</code>.</li>
</ol>
<div class="language-bash codeBlockContainer_y9gH theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_xTJK"><pre tabindex="0" class="prism-code language-bash codeBlock_Nq72 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines__9ny"><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo nano /etc/apt/apt.conf.d/80snapper</span><br></span></code></pre></div></div>
<p>Modify the script to look like below.</p>
<div class="language-bash codeBlockContainer_y9gH theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_xTJK"><pre tabindex="0" class="prism-code language-bash codeBlock_Nq72 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines__9ny"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># https://gist.github.com/imthenachoman/f722f6d08dfb404fed2a3b2d83263118</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=770938</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">DPkg::Pre-Invoke { &quot;/usr/local/sbin/dpkg-pre-post-snapper pre&quot;; };</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">DPkg::Post-Invoke { &quot;/usr/local/sbin/dpkg-pre-post-snapper post&quot;; };</span><br></span></code></pre></div></div>
<ol start="5">
<li class="">Create a baseline snapshot.</li>
</ol>
<div class="language-bash codeBlockContainer_y9gH theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_xTJK"><pre tabindex="0" class="prism-code language-bash codeBlock_Nq72 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines__9ny"><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo snapper -c root create -d &quot;base-install&quot; -u important=yes</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-tip admonition_xX1y alert alert--success"><div class="admonitionHeading_A3Fz"><span class="admonitionIcon__yUe"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_Q3kV"><p>Keep this snapshot around as you can use it to rollback to the base installation at anytime.</p></div></div>
<p>Old output:</p>
<div class="language-bash codeBlockContainer_y9gH theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_xTJK"><pre tabindex="0" class="prism-code language-bash codeBlock_Nq72 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines__9ny"><span class="token-line" style="color:#F8F8F2"><span class="token plain">  # | Type   | Pre # | Date | User | Cleanup | Description  | Userdata</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">----+--------+-------+------+------+---------+--------------+---------------</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> 0  | single |       | ...  | root |         | current      |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> 1  | single |       | ...  | root |         | base-install | important=yes</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> 2  | pre    |       | ...  | root | number  | apt          |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> 3  | post   |     2 | ...  | root | number  | apt          |</span><br></span></code></pre></div></div>
<p>New improved output with more info in the <code>Description</code> table:</p>
<div class="language-bash codeBlockContainer_y9gH theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_xTJK"><pre tabindex="0" class="prism-code language-bash codeBlock_Nq72 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines__9ny"><span class="token-line" style="color:#F8F8F2"><span class="token plain">  # | Type   | Pre # | Date | User | Cleanup | Description                | Userdata</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">----+--------+-------+------+------+---------+----------------------------+---------------</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> 0  | single |       | ...  | root |         | current                    |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> 1  | single |       | ...  | root |         | base-install               | important=yes</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> 2  | pre    |       | ...  | root | number  | apt install btrfs-compsize |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> 3  | post   |     2 | ...  | root | number  | apt install btrfs-compsize |</span><br></span></code></pre></div></div>
<p>This will help greatly to have an idea of what changes happened in our last snapshots.</p>
<h2 class="anchor anchorTargetStickyNavbar_LfiV" id="install-snapper-rollback-for-easy-snapper-rollbacks">Install snapper-rollback for easy snapper rollbacks<a href="#install-snapper-rollback-for-easy-snapper-rollbacks" class="hash-link" aria-label="Direct link to Install snapper-rollback for easy snapper rollbacks" title="Direct link to Install snapper-rollback for easy snapper rollbacks" translate="no">​</a></h2>
<ol>
<li class="">Downlad and install scripts and dependencies.</li>
</ol>
<div class="language-bash codeBlockContainer_y9gH theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_xTJK"><pre tabindex="0" class="prism-code language-bash codeBlock_Nq72 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines__9ny"><span class="token-line" style="color:#F8F8F2"><span class="token plain">cd ~/git</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">git clone https://github.com/jrabinow/snapper-rollback.git</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">cd snapper-rollback</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo cp snapper-rollback.py /usr/local/sbin/snapper-rollback</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo cp snapper-rollback.conf /etc/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo apt install python3-btrfsutil</span><br></span></code></pre></div></div>
<ol start="2">
<li class="">Edit snapper-rollback.conf.</li>
</ol>
<div class="language-bash codeBlockContainer_y9gH theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_xTJK"><pre tabindex="0" class="prism-code language-bash codeBlock_Nq72 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines__9ny"><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo nano /etc/snapper-rollback.conf</span><br></span></code></pre></div></div>
<div class="language-bash codeBlockContainer_y9gH theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_xTJK"><pre tabindex="0" class="prism-code language-bash codeBlock_Nq72 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines__9ny"><span class="token-line" style="color:#F8F8F2"><span class="token plain">subvol_main = @</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">subvol_snapshots = @snapshots</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">mountpoint = /tmp/snapper-rollback-mnt</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">dev = /dev/mapper/vda2_crypt</span><br></span></code></pre></div></div>
<ol start="3">
<li class="">Example rollback as seen <a href="https://github.com/jrabinow/snapper-rollback?tab=readme-ov-file#example-usage" target="_blank" rel="noopener noreferrer" class="">here</a>.</li>
</ol>
<div class="language-bash codeBlockContainer_y9gH theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_xTJK"><pre tabindex="0" class="prism-code language-bash codeBlock_Nq72 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines__9ny"><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo snapper list</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> # | Type   | Pre # | Date                            | User | Cleanup  | Description  | Userdata</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> ---+--------+-------+---------------------------------+------+----------+--------------+---------------------</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> 0  | single |       |                                 | root |          | current      |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> 1  | single |       | Mon 19 Jul 2021 08:59:01 PM PDT | root |          | base-install |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> 2  | single |       | Fri 30 Jul 2021 10:00:08 PM PDT | root | timeline | timeline     |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> 3  | single |       | Fri 30 Jul 2021 11:00:08 PM PDT | root | timeline | timeline     |</span><br></span></code></pre></div></div>
<div class="language-bash codeBlockContainer_y9gH theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_xTJK"><pre tabindex="0" class="prism-code language-bash codeBlock_Nq72 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines__9ny"><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo snapper-rollback 1        # let&#x27;s revert back to the snapshot whos description is `base-install`</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Are you SURE you want to rollback? Type &#x27;CONFIRM&#x27; to continue: CONFIRM</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">2021-10-17 23:25:47,889 - INFO - Rollback to /@snapshots/1/snapshot complete. Reboot to finish</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_LfiV" id="notes">Notes<a href="#notes" class="hash-link" aria-label="Direct link to Notes" title="Direct link to Notes" translate="no">​</a></h2>
<ul>
<li class="">This article is geared to towards Debian and its installer.</li>
<li class="">Once Grub2 gets luks2 support with argon2 the kbkdf can get upgraded to argon2 again.</li>
<li class="">I would much rather use the limine bootloader with snapper and limine-snapper-sync, but alas, I haven&#x27;t gotten that configuration working as of yet in Debian... Maybe in a future article...</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_LfiV" id="references">References<a href="#references" class="hash-link" aria-label="Direct link to References" title="Direct link to References" translate="no">​</a></h2>
<ul>
<li class=""><a href="https://www.matuck.com/tech/2023/09/03/Debian-12-with-LUKS,-BTRFS,-and-subvolumes.html" target="_blank" rel="noopener noreferrer" class="">Debian 12 with LUKS, BTRFS, and subvolumes</a></li>
<li class=""><a href="https://medium.com/@inatagan/installing-debian-with-btrfs-snapper-backups-and-grub-btrfs-27212644175f" target="_blank" rel="noopener noreferrer" class="">Installing Debian with BTRFS, snapper, and grub-btrfs</a></li>
<li class=""><a href="https://gist.github.com/imthenachoman/f722f6d08dfb404fed2a3b2d83263118" target="_blank" rel="noopener noreferrer" class="">Better snapshot descriptions</a></li>
<li class=""><a href="https://cryptsetup-team.pages.debian.net/cryptsetup/encrypted-boot.html" target="_blank" rel="noopener noreferrer" class="">Full disk encryption, including /boot: Unlocking LUKS devices from GRUB</a></li>
<li class=""><a href="https://wiki.cachyos.org/installation/filesystem/#subvolume-layout" target="_blank" rel="noopener noreferrer" class="">CachyOS Wiki - Filesystem - BTRFS - Subvolume Layout</a></li>
<li class=""><a href="https://wiki.archlinux.org/title/Dm-crypt/Device_encryption#Conversion_from_LUKS1_to_LUKS2_and_back" target="_blank" rel="noopener noreferrer" class="">Conversion from LUKS1 to LUKS2 and back</a></li>
<li class=""><a href="https://www.jwillikers.com/btrfs-layout" target="_blank" rel="noopener noreferrer" class="">JWillikers BTRFS Layout</a></li>
<li class=""><a href="https://en.opensuse.org/SDB:BTRFS#Default_Subvolumes" target="_blank" rel="noopener noreferrer" class="">openSUSE Default Subvolumes</a></li>
<li class=""><a href="https://github.com/jrabinow/snapper-rollback" target="_blank" rel="noopener noreferrer" class="">snapper-rollback Github</a></li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col noPrint_glkX"><a href="https://github.com/echo-core/docs-site/tree/main/site/docs/linux-advanced/Debian/debian-install-enc.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_RIz3" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_Mj9F"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/category/linux-howtos---advanced"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Linux Howtos - Advanced</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/linux-advanced/Docker/postgres-upgrades"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Upgrading Postgres SQL in a Docker Environment</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_AVCR thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#install-debian" class="table-of-contents__link toc-highlight">Install Debian</a></li><li><a href="#create-key-to-keep-from-being-asked-for-two-passwords" class="table-of-contents__link toc-highlight">Create key to keep from being asked for two passwords</a></li><li><a href="#configure-snapper-and-grub-btrfs" class="table-of-contents__link toc-highlight">Configure snapper and grub-btrfs</a></li><li><a href="#more-useful-snapshot-descriptions" class="table-of-contents__link toc-highlight">More useful snapshot descriptions</a></li><li><a href="#install-snapper-rollback-for-easy-snapper-rollbacks" class="table-of-contents__link toc-highlight">Install snapper-rollback for easy snapper rollbacks</a></li><li><a href="#notes" class="table-of-contents__link toc-highlight">Notes</a></li><li><a href="#references" class="table-of-contents__link toc-highlight">References</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/welcome">Articles</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/heaven">Heaven</a></li><li class="footer__item"><a href="https://github.com/echo-core/docs-site" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_yTpy"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2026 Echols Home.</div></div></div></footer></div>
</body>
</html>